
Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
    1    1                      ;**************************************************************************************
    2    2                      ;* PS 5 Main [includes LibV2.2]                                                       *
    3    3                      ;**************************************************************************************
    4    4                      ;* Summary:                                                                           *
    5    5                      ;*   -                                                                                *
    6    6                      ;*                                                                                    *
    7    7                      ;* Author: Julia Fay                                                                  *
    8    8                      ;*   Cal Poly University                                                              *
    9    9                      ;*   Fall 2023                                                                        *
   10   10                      ;*                                                                                    *
   11   11                      ;* Revision History:                                                                  *
   12   12                      ;*   -                                                                                *
   13   13                      ;*                                                                                    *
   14   14                      ;* ToDo:                                                                              *
   15   15                      ;*   -                                                                                *
   16   16                      ;**************************************************************************************
   17   17                      
   18   18                      ;/------------------------------------------------------------------------------------\
   19   19                      ;| Include all associated files                                                       |
   20   20                      ;\------------------------------------------------------------------------------------/
   21   21                      ; The following are external files to be included during assembly
   22   22                      
   23   23                      
   24   24                      ;/------------------------------------------------------------------------------------\
   25   25                      ;| External Definitions                                                               |
   26   26                      ;\------------------------------------------------------------------------------------/
   27   27                      ; All labels that are referenced by the linker need an external definition
   28   28                      
   29   29                                    XDEF  main
   30   30                      
   31   31                      ;/------------------------------------------------------------------------------------\
   32   32                      ;| External References                                                                |
   33   33                      ;\------------------------------------------------------------------------------------/
   34   34                      ; All labels from other files must have an external reference
   35   35                      
   36   36                                    XREF  ENABLE_MOTOR, DISABLE_MOTOR
   37   37                                    XREF  STARTUP_MOTOR, UPDATE_MOTOR, CURRENT_MOTOR
   38   38                                    XREF  STARTUP_PWM, STARTUP_ATD0, STARTUP_ATD1
   39   39                                    XREF  OUTDACA, OUTDACB
   40   40                                    XREF  STARTUP_ENCODER, READ_ENCODER
   41   41                                    XREF  INITLCD, SETADDR, GETADDR, CURSOR_ON, CURSOR_OFF, DISP_OFF
   42   42                                    XREF  OUTCHAR, OUTCHAR_AT, OUTSTRING, OUTSTRING_AT
   43   43                                    XREF  INITKEY, LKEY_FLG, GETCHAR
   44   44                                    XREF  LCDTEMPLATE, UPDATELCD_L1, UPDATELCD_L2
   45   45                                    XREF  LVREF_BUF, LVACT_BUF, LERR_BUF,LEFF_BUF, LKP_BUF, LKI_BUF
   46   46                                    XREF  Entry, ISR_KEYPAD
   47   47                                  
   48   48                      ;/------------------------------------------------------------------------------------\
   49   49                      ;| Assembler Equates                                                                  |
   50   50                      ;\------------------------------------------------------------------------------------/
   51   51                      ; Constant values can be equated here
   52   52                      
   53   53                      
   54   54                      
   55   55                      ;/------------------------------------------------------------------------------------\
   56   56                      ;| Variables in RAM                                                                   |
   57   57                      ;\------------------------------------------------------------------------------------/
   58   58                      ; The following variables are located in unpaged ram
   59   59                      
   60   60                      DEFAULT_RAM:  SECTION
   61   61                      
   62   62   000000             TMP DS.B 1
   63   63                      
   64   64                      

Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
   65   65                      ;/------------------------------------------------------------------------------------\
   66   66                      ;|  Main Program Code                                                                 |
   67   67                      ;\------------------------------------------------------------------------------------/
   68   68                      ; Your code goes here
   69   69                      
   70   70                      MyCode:       SECTION
   71   71                      main:   
   72   72                              
   73   73                              
   74   74   000000 CC9C 40            ldd #$9C40
   75   75   000003 CD9C 40            ldy #$9C40
   76   76                      loop: 
   77   77   000006 00                 bgnd 
   78   78   000007 16xx xx            jsr sat_add 
   79   79                              
   80   80                              
   81   81                              
   82   82                              
   83   83                              
   84   84   00000A 20FA        spin:   bra   loop                    ; endless horizontal loop
   85   85                      
   86   86                      
   87   87                      ;/------------------------------------------------------------------------------------\
   88   88                      ;| Subroutines                                                                        |
   89   89                      ;\------------------------------------------------------------------------------------/
   90   90                      ; General purpose subroutines go here
   91   91                      
   92   92                       sat_add: 
   93   93                       
   94   94                       ;push registers to the stack to maintain them
   95   95                       
   96   96   00000C 34                 pshx 
   97   97                             
   98   98                       ;add the contents of d and y 
   99   99                       
  100  100   00000D 7Dxx xx            sty TMP
  101  101   000010 F3xx xx            addd TMP 
  102  102                             
  103  103                       ;check if there is an overflow  and if its negative or positive 
  104  104                       ;if there is, saturate d with either -32,768 or 32,767 
  105  105                       ;if not, keep the results     
  106  106                       
  107  107   000013 2808               bvc skip_overflow 
  108  108   000015 2A03               bpl skip_negative 
  109  109   000017 CC80 00            ldd #$8000        
  110  110                              
  111  111                       skip_negative: 
  112  112                                   
  113  113   00001A CC7F FF            ldd #$7FFF  
  114  114                      
  115  115                       ;restore the registers from the stack 
  116  116                       
  117  117                       skip_overflow: 
  118  118                       
  119  119   00001D 30                  pulx  
  120  120   00001E 3D                  rts 
  121  121                      
  122  122                      
  123  123                      
  124  124                      ;/------------------------------------------------------------------------------------\
  125  125                      ;| ASCII Messages and Constant Data                                                   |
  126  126                      ;\------------------------------------------------------------------------------------/
  127  127                      ; Any constants can be defined here
  128  128                      

Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
  129  129                      
  130  130                      ;/------------------------------------------------------------------------------------\
  131  131                      ;| Vectors                                                                            |
  132  132                      ;\------------------------------------------------------------------------------------/
  133  133                      ; Add interrupt and reset vectors here
  134  134                      
  135  135                              ORG   $FFFE                    ; reset vector address
  136  136  a00FFFE xxxx                DC.W  Entry
  137  137                      
